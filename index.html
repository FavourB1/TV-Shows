<script>
    const tvShows = [
        {"title": "I Love Lucy", "author": "Desi Arnaz, Madelyn Pugh, Bob Carroll Jr.", "year": 1951, "genre": ["Sitcom", "Comedy"]},
        {"title": "The Twilight Zone", "author": "Rod Serling", "year": 1959, "genre": ["Sci-Fi", "Thriller"]},
        {"title": "Doctor Who", "author": "Sydney Newman", "year": 1963, "genre": ["Sci-Fi", "Adventure"]},
        {"title": "Star Trek", "author": "Gene Roddenberry", "year": 1966, "genre": ["Sci-Fi", "Adventure"]},
        // Add more TV shows
    ];

    let displayedShows = [];
    let ratedShows = [];
    let currentShowIndex = 0;

    const highRatingsPerGenre = {};
    const totalRatingsPerGenre = {};
    const ratingCountsPerGenre = {};

    // Function to get random shows excluding already rated ones
    function getRandomShows() {
        const availableShows = tvShows.filter(show => !ratedShows.includes(show.title));
        displayedShows = availableShows.sort(() => 0.5 - Math.random()).slice(0, 10);
        currentShowIndex = 0;
        updateProgressBar();
        displayShow();
    }

    // Function to display the current show
    function displayShow() {
        if (currentShowIndex >= displayedShows.length) {
            displayResults();
            return;
        }
        const show = displayedShows[currentShowIndex];
        document.getElementById("tv-title").textContent = show.title;
        document.getElementById("tv-author").textContent = "Author: " + show.author;
        document.getElementById("tv-year").textContent = "Year: " + show.year;
        document.getElementById("tv-genre").textContent = "Genre: " + show.genre.join(", ");
    }

    // Function to rate the current show
    function rateShow() {
        const rating = document.querySelector('input[name="rating"]:checked')?.value;
        if (!rating) {
            alert("Please select a rating or choose 'Haven't watched'.");
            return;
        }
        const show = displayedShows[currentShowIndex];
        if (rating !== "skip") {
            rateGenre(show, parseInt(rating));
        }
        ratedShows.push(show.title);
        currentShowIndex++;
        updateProgressBar();
        displayShow();
    }

    // Function to skip a show
    function skipShow() {
        currentShowIndex++;
        updateProgressBar();
        displayShow();
    }

    // Function to rate genres and update counts
    function rateGenre(show, rating) {
        show.genre.forEach(genre => {
            if (!highRatingsPerGenre[genre]) highRatingsPerGenre[genre] = 0;
            if (!totalRatingsPerGenre[genre]) totalRatingsPerGenre[genre] = 0;
            if (!ratingCountsPerGenre[genre]) ratingCountsPerGenre[genre] = 0;

            totalRatingsPerGenre[genre] += rating;
            ratingCountsPerGenre[genre] += 1;
            if (rating >= 3) highRatingsPerGenre[genre] += 1;
        });
        console.log("Updated Genre Ratings:", highRatingsPerGenre);
        console.log("Total Ratings:", totalRatingsPerGenre);
        console.log("Rating Counts per Genre:", ratingCountsPerGenre);
    }

    // Progress bar update
    function updateProgressBar() {
        const progress = (currentShowIndex / displayedShows.length) * 100;
        document.getElementById("progress").style.width = `${progress}%`;
    }

    // Function to display results
    function displayResults() {
        const topGenres = Object.entries(highRatingsPerGenre)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3);

        const genreChartCtx = document.getElementById('genreChart').getContext('2d');
        new Chart(genreChartCtx, {
            type: 'bar',
            data: {
                labels: topGenres.map(genre => genre[0]),
                datasets: [{
                    label: 'High Ratings Count',
                    data: topGenres.map(genre => genre[1]),
                    backgroundColor: ['#FF6347', '#32CD32', '#1E90FF'],
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        const availableShows = tvShows.filter(show => !ratedShows.includes(show.title));
        const recommendedShows = availableShows.filter(show =>
            show.genre.some(genre => topGenres.map(g => g[0]).includes(genre))
        );
        console.log("Recommended Shows:", recommendedShows);
    }

    // Function to rate more shows
    function rateMoreShows() {
        getRandomShows();
    }

    // Initialize
    getRandomShows();
</script>
